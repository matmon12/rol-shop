{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, resolveDirective as _resolveDirective, withDirectives as _withDirectives, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-5a90ec03\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"home\"\n};\nconst _hoisted_2 = {\n  class: \"container\"\n};\nconst _hoisted_3 = {\n  class: \"tovar-info\"\n};\nconst _hoisted_4 = {\n  class: \"container\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Category = _resolveComponent(\"Category\");\n  const _component_SliderTop = _resolveComponent(\"SliderTop\");\n  const _component_CardList = _resolveComponent(\"CardList\");\n  const _component_SliderProduct = _resolveComponent(\"SliderProduct\");\n  const _component_InfoText = _resolveComponent(\"InfoText\");\n  const _directive_intersection = _resolveDirective(\"intersection\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_Category, {\n    class: \"category\"\n  })]), _createVNode(_component_SliderTop, {\n    class: \"page-section\"\n  }), _withDirectives(_createVNode(_component_CardList, {\n    \"card-list-name\": \"Суши\",\n    items: $setup.sushi,\n    onAddToFavorite: _cache[0] || (_cache[0] = item => this.addToFavorite(item)),\n    onAddToCart: _cache[1] || (_cache[1] = item => $setup.onClickAddPlus(item)),\n    onLoadMoreItems: _cache[2] || (_cache[2] = $event => !$data.allItemsLoaded_1 ? ($options.loadMoreItems('sushi'), $data.allItemsLoaded_1 = true) : null),\n    class: \"page-section\"\n  }, null, 8 /* PROPS */, [\"items\"]), [[_directive_intersection, {\n    active: () => $options.load('sushi')\n  }]]), _withDirectives(_createVNode(_component_CardList, {\n    \"card-list-name\": \"Роллы\",\n    items: $setup.rolls,\n    onAddToFavorite: _cache[3] || (_cache[3] = item => this.addToFavorite(item)),\n    onAddToCart: _cache[4] || (_cache[4] = item => $setup.onClickAddPlus(item)),\n    onLoadMoreItems: _cache[5] || (_cache[5] = $event => !$data.allItemsLoaded_2 ? ($options.loadMoreItems('rolls'), $data.allItemsLoaded_2 = true) : null),\n    class: \"page-section\"\n  }, null, 8 /* PROPS */, [\"items\"]), [[_directive_intersection, {\n    active: () => $options.load('rolls')\n  }]]), _withDirectives(_createVNode(_component_CardList, {\n    \"card-list-name\": \"Сеты\",\n    items: $setup.sets,\n    onAddToFavorite: _cache[6] || (_cache[6] = item => this.addToFavorite(item)),\n    onAddToCart: _cache[7] || (_cache[7] = item => $setup.onClickAddPlus(item)),\n    onLoadMoreItems: _cache[8] || (_cache[8] = $event => !$data.allItemsLoaded_3 ? ($options.loadMoreItems('sets'), $data.allItemsLoaded_3 = true) : null),\n    class: \"page-section\"\n  }, null, 8 /* PROPS */, [\"items\"]), [[_directive_intersection, {\n    active: () => $options.load('sets')\n  }]]), _createVNode(_component_SliderProduct, {\n    slides: $setup.slides,\n    class: \"page-section\",\n    onSliderAddCart: _cache[9] || (_cache[9] = item => $options.sliderAddCart(item))\n  }, null, 8 /* PROPS */, [\"slides\"]), _withDirectives(_createVNode(_component_CardList, {\n    \"card-list-name\": \"Закуски\",\n    items: $setup.snacks,\n    onAddToFavorite: _cache[10] || (_cache[10] = item => this.addToFavorite(item)),\n    onAddToCart: _cache[11] || (_cache[11] = item => $setup.onClickAddPlus(item)),\n    onLoadMoreItems: _cache[12] || (_cache[12] = $event => !$data.allItemsLoaded_4 ? ($options.loadMoreItems('snacks'), $data.allItemsLoaded_4 = true) : null),\n    class: \"page-section\"\n  }, null, 8 /* PROPS */, [\"items\"]), [[_directive_intersection, {\n    active: () => $options.load('snacks')\n  }]]), _withDirectives(_createVNode(_component_CardList, {\n    \"card-list-name\": \"Напитки\",\n    items: $setup.drinks,\n    onAddToFavorite: _cache[13] || (_cache[13] = item => this.addToFavorite(item)),\n    onAddToCart: _cache[14] || (_cache[14] = item => $setup.onClickAddPlus(item)),\n    onLoadMoreItems: _cache[15] || (_cache[15] = $event => !$data.allItemsLoaded_5 ? ($options.loadMoreItems('drinks'), $data.allItemsLoaded_5 = true) : null),\n    class: \"page-section\"\n  }, null, 8 /* PROPS */, [\"items\"]), [[_directive_intersection, {\n    active: () => $options.load('drinks')\n  }]])]), _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_InfoText, {\n    class: \"tovar-info\"\n  })])])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","_createElementBlock","_Fragment","_createElementVNode","_hoisted_1","_hoisted_2","_createVNode","_component_Category","_component_SliderTop","_component_CardList","items","$setup","sushi","onAddToFavorite","_cache","item","addToFavorite","onAddToCart","onClickAddPlus","onLoadMoreItems","$event","$data","allItemsLoaded_1","$options","loadMoreItems","load","rolls","allItemsLoaded_2","sets","allItemsLoaded_3","_component_SliderProduct","slides","onSliderAddCart","sliderAddCart","snacks","allItemsLoaded_4","drinks","allItemsLoaded_5","_hoisted_3","_hoisted_4","_component_InfoText"],"sources":["C:\\gitPages\\rol-shop\\src\\pages\\Home.vue"],"sourcesContent":["<template>\r\n  <div class=\"home\">\r\n    <div class=\"container\">\r\n      <Category class=\"category\"/>\r\n    </div>\r\n\r\n    <SliderTop class=\"page-section\" />\r\n\r\n    <CardList\r\n      v-intersection=\"{ active: () => load('sushi') }\"\r\n      card-list-name=\"Суши\"\r\n      :items=\"sushi\"\r\n      @add-to-favorite=\"(item) => this.addToFavorite(item)\"\r\n      @add-to-cart=\"(item) => onClickAddPlus(item)\"\r\n      @load-more-items=\"\r\n        !allItemsLoaded_1 ? (loadMoreItems('sushi'), (allItemsLoaded_1 = true)) : null\r\n      \"\r\n      class=\"page-section\"\r\n    />\r\n\r\n    <CardList\r\n      v-intersection=\"{ active: () => load('rolls') }\"\r\n      card-list-name=\"Роллы\"\r\n      :items=\"rolls\"\r\n      @add-to-favorite=\"(item) => this.addToFavorite(item)\"\r\n      @add-to-cart=\"(item) => onClickAddPlus(item)\"\r\n      @load-more-items=\"\r\n        !allItemsLoaded_2 ? (loadMoreItems('rolls'), (allItemsLoaded_2 = true)) : null\r\n      \"\r\n      class=\"page-section\"\r\n    />\r\n\r\n    <CardList\r\n      v-intersection=\"{ active: () => load('sets') }\"\r\n      card-list-name=\"Сеты\"\r\n      :items=\"sets\"\r\n      @add-to-favorite=\"(item) => this.addToFavorite(item)\"\r\n      @add-to-cart=\"(item) => onClickAddPlus(item)\"\r\n      @load-more-items=\"\r\n        !allItemsLoaded_3 ? (loadMoreItems('sets'), (allItemsLoaded_3 = true)) : null\r\n      \"\r\n      class=\"page-section\"\r\n    />  \r\n\r\n    <SliderProduct\r\n      :slides=\"slides\"\r\n      class=\"page-section\"\r\n      @slider-add-cart=\"(item) => sliderAddCart(item)\"\r\n    />\r\n\r\n    <CardList\r\n      v-intersection=\"{ active: () => load('snacks') }\"\r\n      card-list-name=\"Закуски\"\r\n      :items=\"snacks\"\r\n      @add-to-favorite=\"(item) => this.addToFavorite(item)\"\r\n      @add-to-cart=\"(item) => onClickAddPlus(item)\"\r\n      @load-more-items=\"\r\n        !allItemsLoaded_4 ? (loadMoreItems('snacks'), (allItemsLoaded_4 = true)) : null\r\n      \"\r\n      class=\"page-section\"\r\n    />\r\n\r\n    <CardList\r\n      v-intersection=\"{ active: () => load('drinks') }\"\r\n      card-list-name=\"Напитки\"\r\n      :items=\"drinks\"\r\n      @add-to-favorite=\"(item) => this.addToFavorite(item)\"\r\n      @add-to-cart=\"(item) => onClickAddPlus(item)\"\r\n      @load-more-items=\"\r\n        !allItemsLoaded_5 ? (loadMoreItems('drinks'), (allItemsLoaded_5 = true)) : null\r\n      \"\r\n      class=\"page-section\"\r\n    />\r\n\r\n\r\n  </div>\r\n\r\n  <div class=\"tovar-info\">\r\n    <div class=\"container\">\r\n      <InfoText class=\"tovar-info\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { inject, ref } from \"vue\";\r\nimport axios from \"axios\";\r\nimport { mapActions, mapMutations } from \"vuex\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      page: 1,\r\n      limit: 8,\r\n      allItemsLoaded_1: false,\r\n      allItemsLoaded_2: false,\r\n      allItemsLoaded_3: false,\r\n      allItemsLoaded_4: false,\r\n      allItemsLoaded_5: false,\r\n    };\r\n  },\r\n  components: {\r\n  },\r\n  methods: {\r\n    ...mapActions({\r\n      addToFavorite: \"favorite/addToFavorite\",\r\n    }),\r\n    async fetchItems(category) {\r\n      try {\r\n\r\n        const { data } = await axios.get(\r\n          `https://c2ff7a8de0a119c8.mokky.dev/items?page=1&limit=${this.limit}&category=${category}`\r\n        );\r\n\r\n        this[category] = data.items.map((obj) => ({\r\n          ...obj,\r\n          isFavorite: false,\r\n          favoriteId: null,\r\n          isAdded: false,\r\n          count: 1,\r\n        }));\r\n      } catch (err) {\r\n        console.log(err);\r\n      }\r\n    },\r\n    async loadMoreItems(category) {\r\n      try {\r\n        let allItemsLoaded = false;\r\n        let page = 1;\r\n\r\n        while (!allItemsLoaded) {\r\n          page += 1;\r\n\r\n          const { data } = await axios.get(\r\n            `https://c2ff7a8de0a119c8.mokky.dev/items?page=${page}&limit=${this.limit}&category=${category}`\r\n          );\r\n\r\n          this[category] = this[category].concat(\r\n            data.items.map((obj) => ({\r\n              ...obj,\r\n              isFavorite: false,\r\n              favoriteId: null,\r\n              isAdded: false,\r\n              count: 1,\r\n            }))\r\n          );\r\n\r\n          if (data.meta.remaining_count == 0) {\r\n            allItemsLoaded = true;\r\n            this[category] = this[category].map((item) => ({\r\n              ...item,\r\n              isAdded: this.cart.some((cartItem) => cartItem.id === item.id),\r\n            }));\r\n            this.fetchFavorites(category);\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.log(err);\r\n      }\r\n    },\r\n    async fetchFavorites(category) {\r\n      try {\r\n        const { data: favorites } = await axios.get(\r\n          `https://c2ff7a8de0a119c8.mokky.dev/favorites`\r\n        );\r\n\r\n        this[category] = this[category].map((item) => {\r\n          const favorite = favorites.find((favorite) => favorite.item_id === item.id);\r\n\r\n          if (!favorite) {\r\n            return item;\r\n          }\r\n\r\n          return {\r\n            ...item,\r\n            isFavorite: true,\r\n            favoriteId: favorite.id,\r\n          };\r\n        });\r\n      } catch (err) {\r\n        console.log(err);\r\n      }\r\n    },\r\n    load(isCategory) {\r\n      this.fetchItems(isCategory).then(() => {\r\n        // включение кнопки для карточек\r\n        this[isCategory] = this[isCategory].map((item) => ({\r\n          ...item,\r\n          isAdded: this.cart.some((cartItem) => cartItem.id === item.id),\r\n        }));\r\n        // включение кнопки для слайдера\r\n        this.slides = this.slides.map((item) => ({\r\n          ...item,\r\n          isAdded: this.cart.some((cartItem) => cartItem.id === item.id),\r\n        }));\r\n        this.fetchFavorites(isCategory);\r\n      });\r\n    },\r\n    async fetchSlides() {\r\n      try {\r\n        const { data: slides } = await axios.get(\r\n          `https://c2ff7a8de0a119c8.mokky.dev/top`\r\n        );\r\n\r\n        this.slides = slides.map((obj) => ({\r\n          ...obj,\r\n          isAdded: false,\r\n          count: 1\r\n        }));\r\n      } catch (err) {\r\n        console.log(err);\r\n      }\r\n    },\r\n    async sliderAddCart(item) {\r\n      if (!item.isAdded) {\r\n        // для карточек\r\n        this[item.category].forEach((pl) => {\r\n          if (pl.id === item.id) {\r\n            pl.isAdded = true;\r\n            this.cart.push(pl);\r\n          }\r\n        });\r\n\r\n        // для случаев, когда данные для карточек еще не были получены\r\n        if (this[item.category].length === 0) {\r\n          const { data } = await axios.get(\r\n            `https://c2ff7a8de0a119c8.mokky.dev/items?id=${item.id}`\r\n          );\r\n\r\n          this.cart.push(data[0]);\r\n        }\r\n\r\n        // для слайдера\r\n        item.isAdded = true;\r\n      } else {\r\n        // из корзины\r\n        let index = -1;\r\n        for (let i = 0; i < this.cart.length; i++) {\r\n          if (this.cart[i].id === item.id) {\r\n            index = i;\r\n            break;\r\n          }\r\n        }\r\n        if (index !== -1) {\r\n          this.cart.splice(index, 1);\r\n        }\r\n        // для карточек\r\n        this[item.category].forEach((pl) => {\r\n          if (pl.id === item.id) {\r\n            pl.isAdded = false;\r\n            pl.count = 1;\r\n          }\r\n        });\r\n\r\n        // для слайдера\r\n        item.isAdded = false;\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    this.fetchSlides();\r\n  },\r\n  setup() {\r\n    const { sushi, rolls, sets, snacks, drinks, slides } = inject(\"items\");\r\n    const { cart, addToCart, removeFromCart } = inject(\"cart\");\r\n\r\n    const onClickAddPlus = (item) => {\r\n      if (!item.isAdded) {\r\n        addToCart(item);\r\n      } else {\r\n        removeFromCart(item);\r\n      }\r\n    };\r\n\r\n    return {\r\n      sushi,\r\n      rolls,\r\n      sets,\r\n      snacks,\r\n      drinks,\r\n      cart,\r\n      slides,\r\n      onClickAddPlus,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.category{\r\n  margin-bottom: 48px;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}