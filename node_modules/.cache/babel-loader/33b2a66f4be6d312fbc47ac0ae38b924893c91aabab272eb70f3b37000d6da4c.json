{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from \"axios\";\nimport { inject, ref } from \"vue\";\nimport { mapActions, mapMutations } from \"vuex\";\nexport default {\n  data() {\n    return {\n      paths: [{\n        name: \"Профиль\",\n        path: \"/rol-shop/profile\"\n      }, {\n        name: \"Избранное\",\n        path: \"/rol-shop/profilefavorites\"\n      }],\n      limit: 6\n    };\n  },\n  components: {},\n  methods: {\n    ...mapActions({\n      addToFavorite: \"favorite/addToFavorite\"\n    }),\n    ...mapMutations({\n      setPaths: \"crumbs/setPaths\"\n    }),\n    check(item) {\n      this.addToFavorite(item);\n      this.favorites.splice(this.favorites.indexOf(item), 1);\n    },\n    async fetchFavorites() {\n      let apiRes = null;\n      try {\n        const {\n          data\n        } = await axios.get(`https://c2ff7a8de0a119c8.mokky.dev/favorites`);\n        this.favorites = data.map(obj => obj.item);\n        this.favorites.map((obj, index) => obj.favoriteId = data[index].id);\n      } catch (err) {\n        apiRes = err.response.status;\n      } finally {\n        if (apiRes == 404) {\n          this.$router.push('/rol-shop/404');\n        }\n      }\n    },\n    onLoadMoreFavorites() {\n      this.isAllLoading = !this.isAllLoading;\n    },\n    load() {\n      this.fetchFavorites().then(() => {\n        // включение кнопки для карточек\n        this.favorites = this.favorites.map(item => ({\n          ...item,\n          isAdded: this.cart.some(cartItem => cartItem.id === item.id)\n        }));\n      });\n    }\n  },\n  beforeRouteEnter(to, from, next) {\n    next(vm => {\n      vm.setPaths(vm.paths);\n    });\n  },\n  mounted() {\n    this.load();\n  },\n  setup() {\n    const {\n      favorites\n    } = inject(\"items\");\n    const {\n      cart,\n      addToCart,\n      removeFromCart\n    } = inject(\"cart\");\n    const onClickAddPlus = item => {\n      if (!item.isAdded) {\n        addToCart(item);\n      } else {\n        removeFromCart(item);\n        // карточка favorites\n        favorites.value.forEach(pl => {\n          if (pl.id === item.id) {\n            pl.isAdded = false;\n            pl.count = 1;\n          }\n        });\n      }\n    };\n    return {\n      onClickAddPlus,\n      cart,\n      favorites\n    };\n  }\n};","map":{"version":3,"names":["axios","inject","ref","mapActions","mapMutations","data","paths","name","path","limit","components","methods","addToFavorite","setPaths","check","item","favorites","splice","indexOf","fetchFavorites","apiRes","get","map","obj","index","favoriteId","id","err","response","status","$router","push","onLoadMoreFavorites","isAllLoading","load","then","isAdded","cart","some","cartItem","beforeRouteEnter","to","from","next","vm","mounted","setup","addToCart","removeFromCart","onClickAddPlus","value","forEach","pl","count"],"sources":["C:\\gitPages\\rol-shop\\src\\pages\\Favorites.vue"],"sourcesContent":["<template>\r\n  <div class=\"favorites-wrapper\">\r\n    <FavoriteList\r\n      :items=\"favorites\"\r\n      :check=\"isAllLoading\"\r\n      @add-to-favorite=\"(item) => check(item)\"\r\n      @add-to-cart=\"(item) => onClickAddPlus(item)\"\r\n      @load-more-favorites=\"onLoadMoreFavorites()\"\r\n    />\r\n  </div>\r\n\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\nimport { inject, ref } from \"vue\";\r\nimport { mapActions, mapMutations } from \"vuex\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      paths: [\r\n        { name: \"Профиль\", path: \"/rol-shop/profile\" },\r\n        { name: \"Избранное\", path: \"/rol-shop/profilefavorites\" },\r\n      ],\r\n      limit: 6,\r\n    };\r\n  },\r\n  components: {},\r\n  methods: {\r\n    ...mapActions({\r\n      addToFavorite: \"favorite/addToFavorite\",\r\n    }),\r\n    ...mapMutations({\r\n      setPaths: \"crumbs/setPaths\",\r\n    }),\r\n    check(item) {\r\n      this.addToFavorite(item);\r\n      this.favorites.splice(this.favorites.indexOf(item), 1);\r\n    },\r\n    async fetchFavorites() {\r\n      let apiRes = null;\r\n      try {\r\n        const { data } = await axios.get(`https://c2ff7a8de0a119c8.mokky.dev/favorites`);\r\n\r\n        this.favorites = data.map((obj) => obj.item);\r\n        this.favorites.map((obj, index) => (obj.favoriteId = data[index].id));\r\n      } catch (err) {\r\n        apiRes = err.response.status;\r\n      } finally {\r\n        if (apiRes == 404) {\r\n          this.$router.push('/rol-shop/404');\r\n        }\r\n      }\r\n    },\r\n    onLoadMoreFavorites() {\r\n      this.isAllLoading = !this.isAllLoading;\r\n    },\r\n    load() {\r\n      this.fetchFavorites().then(() => {\r\n        // включение кнопки для карточек\r\n        this.favorites = this.favorites.map((item) => ({\r\n          ...item,\r\n          isAdded: this.cart.some((cartItem) => cartItem.id === item.id),\r\n        }));\r\n      });\r\n    },\r\n  },\r\n  beforeRouteEnter(to, from, next) {\r\n    next(vm => {\r\n      vm.setPaths(vm.paths);\r\n    })\r\n  },\r\n  mounted() {\r\n    this.load();\r\n  },\r\n  setup() {\r\n    const { favorites } = inject(\"items\");\r\n    const { cart, addToCart, removeFromCart } = inject(\"cart\");\r\n    const onClickAddPlus = (item) => {\r\n      if (!item.isAdded) {\r\n        addToCart(item);\r\n      } else {\r\n        removeFromCart(item);\r\n        // карточка favorites\r\n        favorites.value.forEach((pl) => {\r\n          if (pl.id === item.id) {\r\n            pl.isAdded = false;\r\n            pl.count = 1;\r\n          }\r\n        });\r\n      }\r\n    };\r\n\r\n    return {\r\n      onClickAddPlus,\r\n      cart,\r\n      favorites,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.favorites {\r\n  &-wrapper {\r\n    width: 100%;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}