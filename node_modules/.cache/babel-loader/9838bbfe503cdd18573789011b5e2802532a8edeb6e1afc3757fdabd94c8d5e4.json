{"ast":null,"code":"import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createVNode as _createVNode, createElementVNode as _createElementVNode, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"app\"\n};\nconst _hoisted_2 = {\n  class: \"app-top\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Drawer = _resolveComponent(\"Drawer\");\n  const _component_Header = _resolveComponent(\"Header\");\n  const _component_router_view = _resolveComponent(\"router-view\");\n  const _component_Footer = _resolveComponent(\"Footer\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [$setup.drawerOpen ? (_openBlock(), _createBlock(_component_Drawer, {\n    key: 0,\n    \"total-price\": $setup.totalPrice,\n    class: \"basket\"\n  }, null, 8 /* PROPS */, [\"total-price\"])) : _createCommentVNode(\"v-if\", true), _createVNode(_component_Header, {\n    onOpenDrawer: $setup.openDrawer,\n    onCloseDrawer: $setup.closeDrawer,\n    \"notif-count\": 2,\n    \"favorite-count\": $setup.countFavorite,\n    \"cart-count\": $setup.cart.length\n  }, null, 8 /* PROPS */, [\"onOpenDrawer\", \"onCloseDrawer\", \"favorite-count\", \"cart-count\"])]), _createVNode(_component_router_view), _createVNode(_component_Footer)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","$setup","drawerOpen","_createBlock","_component_Drawer","key","totalPrice","_createCommentVNode","_createVNode","_component_Header","onOpenDrawer","openDrawer","onCloseDrawer","closeDrawer","countFavorite","cart","length","_component_router_view","_component_Footer"],"sources":["C:\\gitPages\\rol-shop\\src\\App.vue"],"sourcesContent":["<template>\n  <div class=\"app\">\n    <div class=\"app-top\">\n      <Drawer v-if=\"drawerOpen\" :total-price=\"totalPrice\" class=\"basket\" />\n      <Header\n        @open-drawer=\"openDrawer\"\n        @close-drawer=\"closeDrawer\"\n        :notif-count=\"2\"\n        :favorite-count=\"countFavorite\"\n        :cart-count=\"cart.length\"\n      />\n    </div>\n    <router-view></router-view>\n\n    <Footer />\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport { provide, ref, watch, computed } from \"vue\";\nimport { mapState, mapMutations } from \"vuex\";\n\nexport default {\n  name: \"App\",\n  components: {\n  },\n  data() {\n    return {};\n  },\n  computed: {\n    ...mapState({\n      favoriteCount: (state) => state.favorite.favoriteCount,\n    }),\n  },\n  watch: {\n    cart: {\n      handler(newCart) {\n        // оформление заказа / обнуление\n        this.sushi = this.sushi.map((item) => ({ ...item, isAdded: false, count: 1 }));\n        this.rolls = this.rolls.map((item) => ({ ...item, isAdded: false, count: 1 }));\n        this.sets = this.sets.map((item) => ({ ...item, isAdded: false, count: 1 }));\n        this.snacks = this.snacks.map((item) => ({ ...item, isAdded: false, count: 1 }));\n        this.drinks = this.drinks.map((item) => ({ ...item, isAdded: false, count: 1 }));\n\n        this.slides = this.slides.map((item) => ({ ...item, isAdded: false }));\n        this.favorites = this.favorites.map((item) => ({ ...item, isAdded: false }));\n        this.categores = this.categores.map((item) => ({ ...item, isAdded: false }));\n        this.slidesTovar = this.slidesTovar.map((item) => ({ ...item, isAdded: false }));\n        this.products = this.products.map((item) => ({ ...item, isAdded: false }));\n        this.product.isAdded ? this.product.isAdded = false : null;\n      },\n    },\n    favoriteCount: {\n      handler() {\n        this.countFavorite = this.favoriteCount;\n      },\n    },\n  },\n  methods: {\n    ...mapMutations({\n      setFavoriteCount: \"favorite/setFavoriteCount\",\n    }),\n    async fetchFavoritesCount() {\n      try {\n        const { data } = await axios.get(`https://c2ff7a8de0a119c8.mokky.dev/favorites`);\n        this.countFavorite = data.length;\n      } catch (err) {\n        console.log(err);\n      }\n    },\n  },\n  mounted() {\n    // получение корзины\n    const localCart = localStorage.getItem(\"cart\");\n    this.cart = localCart ? JSON.parse(localCart) : [];\n\n    // история получение данных\n    const historyCart = localStorage.getItem(\"order\");\n    this.historyOrder = historyCart ? JSON.parse(historyCart) : [];\n\n    // кол-во favorites\n    this.fetchFavoritesCount().then(() => {\n      this.setFavoriteCount(this.countFavorite);\n    });\n  },\n  setup() {\n    const favorites = ref([]);\n    const countFavorite = ref(0);\n    const slides = ref([]);\n    const cart = ref([]);\n    const sushi = ref([]);\n    const rolls = ref([]);\n    const sets = ref([]);\n    const snacks = ref([]);\n    const drinks = ref([]);\n    const drawerOpen = ref(false);\n    const historyOrder = ref([]);\n    const categores = ref([]);\n    const product = ref([]);\n    const slidesTovar = ref([]);\n    const address = ref([]);\n    const products = ref([]);\n\n\n    const categoryMap = {\n      sushi: sushi,\n      rolls: rolls,\n      sets: sets,\n      snacks: snacks,\n      drinks: drinks,\n    };\n\n    const area = \"22.555291,46.410475,39.940511,52.517961\";\n\n    const totalPrice = computed(() => {\n      return cart.value.reduce((acc, item) => acc + item.price * item.count, 0);\n    });\n\n    watch(\n      cart,\n      () => {\n        localStorage.setItem(\"cart\", JSON.stringify(cart.value));\n      },\n      { deep: true }\n    );\n\n    const closeDrawer = () => {\n      drawerOpen.value = false;\n    };\n\n    const openDrawer = () => {\n      drawerOpen.value = true;\n    };\n\n    const addToCart = (item) => {\n      cart.value.push(item);\n      item.isAdded = true;\n\n      // слайды\n      CartSync(item, true);\n    };\n\n    const removeFromCart = (item) => {\n      // из корзины\n      let index = -1;\n      for (let i = 0; i < cart.value.length; i++) {\n        if (cart.value[i].id === item.id) {\n          index = i;\n          break;\n        }\n      }\n      if (index !== -1) {\n        cart.value.splice(index, 1);\n      }\n      // карточка\n      categoryMap[item.category].value.forEach((pl) => {\n        if (pl.id === item.id) {\n          pl.isAdded = false;\n          pl.count = 1;\n        }\n      });\n      // карточка favorites\n      favorites.value.forEach((pl) => {\n        if (pl.id === item.id) {\n          pl.isAdded = false;\n          pl.count = 1;\n        }\n      });\n      // карточка categores\n      categores.value.forEach((pl) => {\n        if (pl.id === item.id) {\n          pl.isAdded = false;\n          pl.count = 1;\n        }\n      });\n      // карточка sliderTovar\n      slidesTovar.value.forEach((pl) => {\n        if (pl.id === item.id) {\n          pl.isAdded = false;\n          pl.count = 1;\n        }\n      });\n      // слайдер заказ оформление\n      products.value.forEach((pl) => {\n        if (pl.id === item.id) {\n          pl.isAdded = false;\n          pl.count = 1;\n        }\n      });\n      // товар\n      product.value.isAdded = false;\n      product.value.count = 1;\n      // слайды\n      CartSync(item, false);\n    };\n\n    // синхрон добавления в корзину между карточками и слайдером\n    const CartSync = (item, check) => {\n      slides.value = slides.value.map((el) => {\n        if (el.id == item.id) {\n          return {\n            ...el,\n            isAdded: check,\n          };\n        } else {\n          return el;\n        }\n      });\n    };\n\n    // кол-во товара\n    const countPlus = (item) => {\n      item.count = item.count + 1;\n    };\n    const countMinus = (item) => {\n      if (item.count > 1) {\n        item.count = item.count - 1;\n      }\n    };\n\n    provide(\"items\", {\n      sushi,\n      rolls,\n      sets,\n      snacks,\n      drinks,\n      slides,\n      favorites,\n      countFavorite,\n      categores,\n      product,\n      slidesTovar,\n      products\n    });\n\n    provide(\"cart\", {\n      cart,\n      addToCart,\n      removeFromCart,\n      closeDrawer,\n      openDrawer,\n      drawerOpen,\n      countPlus,\n      countMinus,\n      historyOrder,\n      totalPrice\n    });\n\n    provide(\"address\", {\n      address,\n      area\n    });\n\n    return {\n      sushi,\n      rolls,\n      sets,\n      snacks,\n      drinks,\n      cart,\n      addToCart,\n      removeFromCart,\n      closeDrawer,\n      openDrawer,\n      drawerOpen,\n      slides,\n      countPlus,\n      countMinus,\n      totalPrice,\n      historyOrder,\n      favorites,\n      countFavorite,\n      categores,\n      product,\n      slidesTovar,\n      products\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\">\n.app {\n  padding-top: 122px;\n}\n.app-top {\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  z-index: 200;\n}\n.basket {\n  height: 100vh;\n  background: rgba(26, 26, 26, 0.4);\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  z-index: -1;\n  padding-top: 122px;\n}\n</style>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAK;;EACTA,KAAK,EAAC;AAAS;;;;;;uBADtBC,mBAAA,CAcM,OAdNC,UAcM,GAbJC,mBAAA,CASM,OATNC,UASM,GARUC,MAAA,CAAAC,UAAU,I,cAAxBC,YAAA,CAAqEC,iBAAA;IAH3EC,GAAA;IAGiC,aAAW,EAAEJ,MAAA,CAAAK,UAAU;IAAEV,KAAK,EAAC;8CAHhEW,mBAAA,gBAIMC,YAAA,CAMEC,iBAAA;IALCC,YAAW,EAAET,MAAA,CAAAU,UAAU;IACvBC,aAAY,EAAEX,MAAA,CAAAY,WAAW;IACzB,aAAW,EAAE,CAAC;IACd,gBAAc,EAAEZ,MAAA,CAAAa,aAAa;IAC7B,YAAU,EAAEb,MAAA,CAAAc,IAAI,CAACC;gGAGtBR,YAAA,CAA2BS,sBAAA,GAE3BT,YAAA,CAAUU,iBAAA,E"},"metadata":{},"sourceType":"module","externalDependencies":[]}