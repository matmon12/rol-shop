{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, resolveDirective as _resolveDirective, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createBlock as _createBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-5a90ec03\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  key: 0\n};\nconst _hoisted_2 = {\n  class: \"home\"\n};\nconst _hoisted_3 = {\n  class: \"container\"\n};\nconst _hoisted_4 = {\n  class: \"tovar-info\"\n};\nconst _hoisted_5 = {\n  class: \"container\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Category = _resolveComponent(\"Category\");\n  const _component_SliderTop = _resolveComponent(\"SliderTop\");\n  const _component_CardList = _resolveComponent(\"CardList\");\n  const _component_SliderProduct = _resolveComponent(\"SliderProduct\");\n  const _component_InfoText = _resolveComponent(\"InfoText\");\n  const _component_Error = _resolveComponent(\"Error\");\n  const _directive_intersection = _resolveDirective(\"intersection\");\n  return !$data.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_Category, {\n    class: \"category\"\n  })]), _createVNode(_component_SliderTop, {\n    class: \"page-section\"\n  }), _withDirectives(_createVNode(_component_CardList, {\n    \"card-list-name\": \"Суши\",\n    items: $setup.sushi,\n    onAddToFavorite: _cache[0] || (_cache[0] = item => this.addToFavorite(item)),\n    onAddToCart: _cache[1] || (_cache[1] = item => $setup.onClickAddPlus(item)),\n    onLoadMoreItems: _cache[2] || (_cache[2] = $event => !$data.allItemsLoaded_1 ? ($options.loadMoreItems('sushi'), $data.allItemsLoaded_1 = true) : null),\n    class: \"page-section\"\n  }, null, 8 /* PROPS */, [\"items\"]), [[_directive_intersection, {\n    active: () => $options.load('sushi')\n  }]]), _withDirectives(_createVNode(_component_CardList, {\n    \"card-list-name\": \"Роллы\",\n    items: $setup.rolls,\n    onAddToFavorite: _cache[3] || (_cache[3] = item => this.addToFavorite(item)),\n    onAddToCart: _cache[4] || (_cache[4] = item => $setup.onClickAddPlus(item)),\n    onLoadMoreItems: _cache[5] || (_cache[5] = $event => !$data.allItemsLoaded_2 ? ($options.loadMoreItems('rolls'), $data.allItemsLoaded_2 = true) : null),\n    class: \"page-section\"\n  }, null, 8 /* PROPS */, [\"items\"]), [[_directive_intersection, {\n    active: () => $options.load('rolls')\n  }]]), _withDirectives(_createVNode(_component_CardList, {\n    \"card-list-name\": \"Сеты\",\n    items: $setup.sets,\n    onAddToFavorite: _cache[6] || (_cache[6] = item => this.addToFavorite(item)),\n    onAddToCart: _cache[7] || (_cache[7] = item => $setup.onClickAddPlus(item)),\n    onLoadMoreItems: _cache[8] || (_cache[8] = $event => !$data.allItemsLoaded_3 ? ($options.loadMoreItems('sets'), $data.allItemsLoaded_3 = true) : null),\n    class: \"page-section\"\n  }, null, 8 /* PROPS */, [\"items\"]), [[_directive_intersection, {\n    active: () => $options.load('sets')\n  }]]), _createVNode(_component_SliderProduct, {\n    slides: $setup.slides,\n    class: \"page-section\",\n    onSliderAddCart: _cache[9] || (_cache[9] = item => $options.sliderAddCart(item))\n  }, null, 8 /* PROPS */, [\"slides\"]), _withDirectives(_createVNode(_component_CardList, {\n    \"card-list-name\": \"Закуски\",\n    items: $setup.snacks,\n    onAddToFavorite: _cache[10] || (_cache[10] = item => this.addToFavorite(item)),\n    onAddToCart: _cache[11] || (_cache[11] = item => $setup.onClickAddPlus(item)),\n    onLoadMoreItems: _cache[12] || (_cache[12] = $event => !$data.allItemsLoaded_4 ? ($options.loadMoreItems('snacks'), $data.allItemsLoaded_4 = true) : null),\n    class: \"page-section\"\n  }, null, 8 /* PROPS */, [\"items\"]), [[_directive_intersection, {\n    active: () => $options.load('snacks')\n  }]]), _withDirectives(_createVNode(_component_CardList, {\n    \"card-list-name\": \"Напитки\",\n    items: $setup.drinks,\n    onAddToFavorite: _cache[13] || (_cache[13] = item => this.addToFavorite(item)),\n    onAddToCart: _cache[14] || (_cache[14] = item => $setup.onClickAddPlus(item)),\n    onLoadMoreItems: _cache[15] || (_cache[15] = $event => !$data.allItemsLoaded_5 ? ($options.loadMoreItems('drinks'), $data.allItemsLoaded_5 = true) : null),\n    class: \"page-section\"\n  }, null, 8 /* PROPS */, [\"items\"]), [[_directive_intersection, {\n    active: () => $options.load('drinks')\n  }]])]), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", _hoisted_5, [_createVNode(_component_InfoText, {\n    class: \"tovar-info\"\n  })])])])) : (_openBlock(), _createBlock(_component_Error, {\n    key: 1,\n    imgUrl: require('@/img/icon/404.svg'),\n    title: ['Ошибка 404.', 'Что-то пошло не так.'],\n    text: \"Страница, которую вы ищите, временно не доступна или ее еже нет\",\n    button: {\n      imgUrl: '',\n      text: 'Вернуться на главную'\n    },\n    onClickError: _cache[16] || (_cache[16] = () => {})\n  }, null, 8 /* PROPS */, [\"imgUrl\", \"title\"]));\n}","map":{"version":3,"names":["key","class","$data","error","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_Category","_component_SliderTop","_component_CardList","items","$setup","sushi","onAddToFavorite","_cache","item","addToFavorite","onAddToCart","onClickAddPlus","onLoadMoreItems","$event","allItemsLoaded_1","$options","loadMoreItems","load","rolls","allItemsLoaded_2","sets","allItemsLoaded_3","_component_SliderProduct","slides","onSliderAddCart","sliderAddCart","snacks","allItemsLoaded_4","drinks","allItemsLoaded_5","_hoisted_4","_hoisted_5","_component_InfoText","_createBlock","_component_Error","imgUrl","require","title","text","button","onClickError"],"sources":["C:\\gitPages\\rol-shop\\src\\pages\\Home.vue"],"sourcesContent":["<template>\r\n  <div v-if=\"!error\">\r\n    <div class=\"home\">\r\n      <div class=\"container\">\r\n        <Category class=\"category\" />\r\n      </div>\r\n\r\n      <SliderTop class=\"page-section\" />\r\n\r\n      <CardList\r\n        v-intersection=\"{ active: () => load('sushi') }\"\r\n        card-list-name=\"Суши\"\r\n        :items=\"sushi\"\r\n        @add-to-favorite=\"(item) => this.addToFavorite(item)\"\r\n        @add-to-cart=\"(item) => onClickAddPlus(item)\"\r\n        @load-more-items=\"\r\n          !allItemsLoaded_1 ? (loadMoreItems('sushi'), (allItemsLoaded_1 = true)) : null\r\n        \"\r\n        class=\"page-section\"\r\n      />\r\n\r\n      <CardList\r\n        v-intersection=\"{ active: () => load('rolls') }\"\r\n        card-list-name=\"Роллы\"\r\n        :items=\"rolls\"\r\n        @add-to-favorite=\"(item) => this.addToFavorite(item)\"\r\n        @add-to-cart=\"(item) => onClickAddPlus(item)\"\r\n        @load-more-items=\"\r\n          !allItemsLoaded_2 ? (loadMoreItems('rolls'), (allItemsLoaded_2 = true)) : null\r\n        \"\r\n        class=\"page-section\"\r\n      />\r\n\r\n      <CardList\r\n        v-intersection=\"{ active: () => load('sets') }\"\r\n        card-list-name=\"Сеты\"\r\n        :items=\"sets\"\r\n        @add-to-favorite=\"(item) => this.addToFavorite(item)\"\r\n        @add-to-cart=\"(item) => onClickAddPlus(item)\"\r\n        @load-more-items=\"\r\n          !allItemsLoaded_3 ? (loadMoreItems('sets'), (allItemsLoaded_3 = true)) : null\r\n        \"\r\n        class=\"page-section\"\r\n      />\r\n\r\n      <SliderProduct\r\n        :slides=\"slides\"\r\n        class=\"page-section\"\r\n        @slider-add-cart=\"(item) => sliderAddCart(item)\"\r\n      />\r\n\r\n      <CardList\r\n        v-intersection=\"{ active: () => load('snacks') }\"\r\n        card-list-name=\"Закуски\"\r\n        :items=\"snacks\"\r\n        @add-to-favorite=\"(item) => this.addToFavorite(item)\"\r\n        @add-to-cart=\"(item) => onClickAddPlus(item)\"\r\n        @load-more-items=\"\r\n          !allItemsLoaded_4 ? (loadMoreItems('snacks'), (allItemsLoaded_4 = true)) : null\r\n        \"\r\n        class=\"page-section\"\r\n      />\r\n\r\n      <CardList\r\n        v-intersection=\"{ active: () => load('drinks') }\"\r\n        card-list-name=\"Напитки\"\r\n        :items=\"drinks\"\r\n        @add-to-favorite=\"(item) => this.addToFavorite(item)\"\r\n        @add-to-cart=\"(item) => onClickAddPlus(item)\"\r\n        @load-more-items=\"\r\n          !allItemsLoaded_5 ? (loadMoreItems('drinks'), (allItemsLoaded_5 = true)) : null\r\n        \"\r\n        class=\"page-section\"\r\n      />\r\n    </div>\r\n\r\n    <div class=\"tovar-info\">\r\n      <div class=\"container\">\r\n        <InfoText class=\"tovar-info\" />\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <Error\r\n    v-else\r\n    :imgUrl=\"require('@/img/icon/404.svg')\"\r\n    :title=\"['Ошибка 404.', 'Что-то пошло не так.']\"\r\n    text=\"Страница, которую вы ищите, временно не доступна или ее еже нет\"\r\n    :button=\"{imgUrl: '', text: 'Вернуться на главную'}\"\r\n    @click-error=\"\"\r\n  />\r\n</template>\r\n\r\n<script>\r\nimport { inject, ref } from \"vue\";\r\nimport axios from \"axios\";\r\nimport { mapActions, mapMutations } from \"vuex\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      page: 1,\r\n      limit: 8,\r\n      allItemsLoaded_1: false,\r\n      allItemsLoaded_2: false,\r\n      allItemsLoaded_3: false,\r\n      allItemsLoaded_4: false,\r\n      allItemsLoaded_5: false,\r\n      error: false,\r\n    };\r\n  },\r\n  components: {},\r\n  methods: {\r\n    ...mapActions({\r\n      addToFavorite: \"favorite/addToFavorite\",\r\n    }),\r\n    async fetchItems(category) {\r\n      let apiRes = null;\r\n      try {\r\n        const { data } = await axios.get(\r\n          `https://c2ff7a8de0a119c8.mokky.dev/items?page=1&limit=${this.limit}&category=${category}`\r\n        );\r\n\r\n        this[category] = data.items.map((obj) => ({\r\n          ...obj,\r\n          isFavorite: false,\r\n          favoriteId: null,\r\n          isAdded: false,\r\n          count: 1,\r\n        }));\r\n      } catch (err) {\r\n        apiRes = err.response.status;\r\n      } finally {\r\n        if (apiRes == 404) {\r\n          this.error = true;\r\n        }\r\n      }\r\n    },\r\n    async loadMoreItems(category) {\r\n      let apiRes = null;\r\n      try {\r\n        let allItemsLoaded = false;\r\n        let page = 1;\r\n\r\n        while (!allItemsLoaded) {\r\n          page += 1;\r\n\r\n          const { data } = await axios.get(\r\n            `https://c2ff7a8de0a119c8.mokky.dev/itfems?page=${page}&limit=${this.limit}&category=${category}`\r\n          );\r\n\r\n          this[category] = this[category].concat(\r\n            data.items.map((obj) => ({\r\n              ...obj,\r\n              isFavorite: false,\r\n              favoriteId: null,\r\n              isAdded: false,\r\n              count: 1,\r\n            }))\r\n          );\r\n\r\n          if (data.meta.remaining_count == 0) {\r\n            allItemsLoaded = true;\r\n            this[category] = this[category].map((item) => ({\r\n              ...item,\r\n              isAdded: this.cart.some((cartItem) => cartItem.id === item.id),\r\n            }));\r\n            this.fetchFavorites(category);\r\n          }\r\n        }\r\n      } catch (err) {\r\n        apiRes = err.response.status;\r\n      } finally {\r\n        if (apiRes == 404) {\r\n          this.error = true;\r\n        }\r\n      }\r\n    },\r\n    async fetchFavorites(category) {\r\n      try {\r\n        const { data: favorites } = await axios.get(\r\n          `https://c2ff7a8de0a119c8.mokky.dev/favorites`\r\n        );\r\n\r\n        this[category] = this[category].map((item) => {\r\n          const favorite = favorites.find((favorite) => favorite.item_id === item.id);\r\n\r\n          if (!favorite) {\r\n            return item;\r\n          }\r\n\r\n          return {\r\n            ...item,\r\n            isFavorite: true,\r\n            favoriteId: favorite.id,\r\n          };\r\n        });\r\n      } catch (err) {\r\n        console.log(err);\r\n      }\r\n    },\r\n    load(isCategory) {\r\n      this.fetchItems(isCategory).then(() => {\r\n        // включение кнопки для карточек\r\n        this[isCategory] = this[isCategory].map((item) => ({\r\n          ...item,\r\n          isAdded: this.cart.some((cartItem) => cartItem.id === item.id),\r\n        }));\r\n        // включение кнопки для слайдера\r\n        this.slides = this.slides.map((item) => ({\r\n          ...item,\r\n          isAdded: this.cart.some((cartItem) => cartItem.id === item.id),\r\n        }));\r\n        this.fetchFavorites(isCategory);\r\n      });\r\n    },\r\n    async fetchSlides() {\r\n      try {\r\n        const { data: slides } = await axios.get(\r\n          `https://c2ff7a8de0a119c8.mokky.dev/top`\r\n        );\r\n\r\n        this.slides = slides.map((obj) => ({\r\n          ...obj,\r\n          isAdded: false,\r\n          count: 1,\r\n        }));\r\n      } catch (err) {\r\n        console.log(err);\r\n      }\r\n    },\r\n    async sliderAddCart(item) {\r\n      if (!item.isAdded) {\r\n        // для карточек\r\n        this[item.category].forEach((pl) => {\r\n          if (pl.id === item.id) {\r\n            pl.isAdded = true;\r\n            this.cart.push(pl);\r\n          }\r\n        });\r\n\r\n        // для случаев, когда данные для карточек еще не были получены\r\n        if (this[item.category].length === 0) {\r\n          const { data } = await axios.get(\r\n            `https://c2ff7a8de0a119c8.mokky.dev/items?id=${item.id}`\r\n          );\r\n\r\n          this.cart.push(data[0]);\r\n        }\r\n\r\n        // для слайдера\r\n        item.isAdded = true;\r\n      } else {\r\n        // из корзины\r\n        let index = -1;\r\n        for (let i = 0; i < this.cart.length; i++) {\r\n          if (this.cart[i].id === item.id) {\r\n            index = i;\r\n            break;\r\n          }\r\n        }\r\n        if (index !== -1) {\r\n          this.cart.splice(index, 1);\r\n        }\r\n        // для карточек\r\n        this[item.category].forEach((pl) => {\r\n          if (pl.id === item.id) {\r\n            pl.isAdded = false;\r\n            pl.count = 1;\r\n          }\r\n        });\r\n\r\n        // для слайдера\r\n        item.isAdded = false;\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    this.fetchSlides();\r\n  },\r\n  setup() {\r\n    const { sushi, rolls, sets, snacks, drinks, slides } = inject(\"items\");\r\n    const { cart, addToCart, removeFromCart } = inject(\"cart\");\r\n\r\n    const onClickAddPlus = (item) => {\r\n      if (!item.isAdded) {\r\n        addToCart(item);\r\n      } else {\r\n        removeFromCart(item);\r\n      }\r\n    };\r\n\r\n    return {\r\n      sushi,\r\n      rolls,\r\n      sets,\r\n      snacks,\r\n      drinks,\r\n      cart,\r\n      slides,\r\n      onClickAddPlus,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.category {\r\n  margin-bottom: 48px;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}